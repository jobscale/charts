# Install EFK Logging Setup


#### Add Qubole's Helm Repo

```bash
helm repo add qubole https://qubole.github.io/charts/
helm repo update
```


## **Install**

#### Helm v2
```bash
helm --namespace qubole-logging --name efk install qubole/logging
```

#### Helm V3
```bash
kubectl create ns qubole-logging
helm install --namespace qubole-logging efk qubole/logging
```

#### Kustomize
```bash
kubectl create -k kustomize/logging/base/
```

#### Kustomize (Minikube, runs on lower resources)
```bash
kubectl create -k kustomize/logging/minikube/
```

### Accessing Kibana UI

```console
kubectl -n qubole-logging port-forward svc/efk-kibana 5601
# access on http://localhost:5601
```

### Persistence Options

* AWS S3
  * Download this [S3 Config File](../stable/logging/values/values-elastic-s3.yaml) and save it as `values-elastic-s3.yaml`
  * Edit the file to add S3 credentials where written as `<s3 credentials here>`
  * Then, run command:
    ```bash
    helm --namespace qubole-logging --name efk install qubole/logging -f ./values-elastic-s3.yaml
    ```
  

* Web HDFS
  * Download this [HDFS Config File](../stable/logging/values/values-elastic-hdfs.yaml) and save it as `values-elastic-hdfs.yaml`
  * If you have your own HDFS Setup:
    * Replace the configs `host efk-hadoop-hdfs-nn` and `port 50070` in the file above with your web hdfs url and port
  * If you don't have your own HDFS:
    * Install Hadoop Chart from https://github.com/helm/charts/tree/master/stable/hadoop `helm install --name hadoop stable/hadoop --namespace qubole-logging`
  * Then, run command:
    ```bash
    helm --namespace qubole-logging --name efk install qubole/logging -f ./values-elastic-hdfs.yaml
    ```
  
  
* Persistent Volume
  * Create a Persistent volume with writePolicy as `ReadWriteMulti`
  * Download this [HDFS Config File](../stable/logging/values/values-elastic-pv.yaml) and save it as `values-elastic-pv.yaml`
  * Under `extraVolumes` in the Yaml file add details to your PVC
  * Then, run command:
    ```bash
    helm --namespace qubole-logging --name efk install qubole/logging -f ./values-elastic-pv.yaml
    ```
  
  
  
## Configuration Options

#### Logging

| Parameter                       | Description                              | Default            |
| ------------------------------- | -----------------------------------------| -------------------|
| `nameOverride`                  | Name override for chart                  | `-`                |
| `fullnameOverride`              | Full Name override for chart             | `-`                |
| `resources`                     | Resources for pods                       | `-`                |
| `nodeSelector`                  | NodeSelector label                       | `-`                |
| `tolerations`                   | Pod Tolerations                          | `{}`               |
| `affinity`                      | Pod Affinity                             | `{}`               |
| `rbac.create`                   | To create RBAC policies or not           | `true`             |
| `fluentd.enabled`               | To enable Fluent Aggregator              | `true`             |
| `elasticsearch.enabled`         | Enable ElasticSearch Setup               | `true`             |
| `kibana.enabled`                | To enable Kibana UI                      | `true`             |
| `fluentdForwarder.enabled`      | Enable Fluent Forwarder                  | `true`             |


#### Fluentd Forwarder


| Parameter                       | Description                              | Default            |
| ------------------------------- | -----------------------------------------| -------------------|
| `fluentdForwarder.nameOverride`                  | Name override for chart                  |    `-`             |
| `fluentdForwarder.fullnameOverride`              | Full Name override for chart             |    `-`             |
| `fluentdForwarder.resources`                     | Resources for pods                       | See [values.yaml](../stable/logging/values.yaml) |
| `fluentdForwarder.nodeSelector`                  | NodeSelector label                       | `-`                |
| `fluentdForwarder.tolerations`                   | Pod Tolerations                          | `{}`               |
| `fluentdForwarder.affinity`                      | Pod Affinity                             | `{}`               |
| `fluentdForwarder.containerName`                 | Name of DaemonSet Container              | `fluentd-forwarder`|
| `fluentdForwarder.image.name`                    | Image URL                                | `fluent/fluentd-kubernetes-daemonset` |
| `fluentdForwarder.image.tag`                     | Image Tag                                | `v1.3.3-debian-forward-1.3`|
| `fluentdForwarder.image.pullPolicy`              | Image Pull Policy                        | `IfNotPresent`     |
| `fluentdForwarder.forward.host`                  | Host url to fluentd Aggregator           | `efk-fluentd.qubole-logging.svc.cluster.local` |
| `fluentdForwarder.forward.port`                  | Host port to fluentd Aggregator          | `24224`            |
| `fluentdForwarder.extraEnvVars`                  | Pass any extra env variables             | `{}`               |
| `fluentdForwarder.serviceAccount.create`         | create Service Account or not            | `true`             |
| `fluentdForwarder.tolerations`                   | Any Tolerations for the pod              | See [values.yaml](../stable/logging/values.yaml)|
| `fluentdForwarder.config`                        | Fluentd config for forwarder             | See [values.yaml](../stable/logging/values.yaml)|

#### [Fluentd](https://github.com/helm/charts/tree/master/stable/fluentd)

Parameter | Description | Default
--- | --- | ---
`fluentd.affinity` | node/pod affinities | `{}`
`fluentd.configMaps` | Fluentd configuration | See [values.yaml](../stable/logging/values.yaml)
`fluentd.output.host` | output host | `elasticsearch-client.default.svc.cluster.local`
`fluentd.output.port` | output port | `9200`
`fluentd.output.scheme` | output scheme | `http`
`fluentd.output.sslVersion` | output ssl version | `TLSv1`
`fluentd.output.buffer_chunk_limit` | output buffer chunk limit | `2M`
`fluentd.output.buffer_queue_limit` | output buffer queue limit | `8`
`fluentd.image.pullPolicy` | Image pull policy | `IfNotPresent`
`fluentd.image.repository` | Image repository | `gcr.io/google-containers/fluentd-elasticsearch`
`fluentd.image.tag` | Image tag | `v2.4.0`
`fluentd.imagePullSecrets` | Specify image pull secrets | `nil` (does not add image pull secrets to deployed pods)
`fluentd.extraEnvVars` | Adds additional environment variables to the deployment (in yaml syntax) | `{}` See [values.yaml](../stable/logging/values.yaml)
`fluentd.extraVolumeMounts` | Mount extra volumes (in yaml syntax) | `` See [values.yaml](../stable/logging/values.yaml)
`fluentd.extraVolumes` | Extra volumes (in yaml syntax) | `` See [values.yaml](../stable/logging/values.yaml)
`fluentd.ingress.enabled` | enable ingress | `false`
`fluentd.ingress.labels` | list of labels for the ingress rule | See [values.yaml](../stable/logging/values.yaml)
`fluentd.ingress.annotations` | list of annotations for the ingress rule | `kubernetes.io/ingress.class: nginx` See [values.yaml](../stable/logging/values.yaml)
`fluentd.ingress.hosts` | host definition for ingress | See [values.yaml](../stable/logging/values.yaml)
`fluentd.ingress.tls` | tls rules for ingress | See [values.yaml](../stable/logging/values.yaml)
`fluentd.nodeSelector` | node labels for pod assignment | `{}`
`fluentd.replicaCount` | desired number of pods | `1` ???
`fluentd.resources` | pod resource requests & limits | `{}`
`fluentd.plugins.enabled` | Enable Plugins Installation | `false`
`fluentd.plugins.pluginsList` | List of plugins to install | `[]`
`fluentd.rbac.create` | Specifies whether RBAC resources should be created | `true`
`fluentd.serviceAccount.create` | Specifies whether a service account should be created. | `true`
`fluentd.serviceAccount.name` | Name of the service account.
`fluentd.priorityClassName` | priorityClassName | `nil`
`fluentd.service.loadBalancerIP` | If `service.type` is `LoadBalancer` set custom IP load balancer IP address | `nil`
`fluentd.service.ports` | port definition for the service | See [values.yaml](../stable/logging/values.yaml)
`fluentd.service.type` | type of service | `ClusterIP`
`fluentd.service.annotations` | list of annotations for the service | `{}`
`fluentd.tolerations` | List of node taints to tolerate | `[]`
`fluentd.persistence.enabled` | Enable buffer persistence | `false`
`fluentd.persistence.accessMode` | Access mode for buffer persistence | `ReadWriteOnce`
`fluentd.persistence.size` | Volume size for buffer persistence | `10Gi`
`fluentd.autoscaling.enabled` | Set this to `true` to enable autoscaling | `false`
`fluentd.autoscaling.minReplicas` | Set minimum number of replicas | `2`
`fluentd.autoscaling.maxReplicas` | Set maximum number of replicas | `5`
`fluentd.autoscaling.metrics` | metrics used for autoscaling | See [values.yaml](../stable/logging/values.yaml)
`fluentd.terminationGracePeriodSeconds` | Optional duration in seconds the pod needs to terminate gracefully | `30`
`fluentd.metrics.enabled`                         | Set this to `true` to enable Prometheus metrics HTTP endpoint                         | `false`
`fluentd.metrics.service.port`                    | Prometheus metrics HTTP endpoint port                                                 | `24231`
`fluentd.metrics.serviceMonitor.enabled`          | Set this to `true` to create ServiceMonitor for Prometheus operator                   | `false`
`fluentd.metrics.serviceMonitor.additionalLabels` | Additional labels that can be used so ServiceMonitor will be discovered by Prometheus | `{}`
`fluentd.metrics.serviceMonitor.namespace`        | Optional namespace in which to create ServiceMonitor                                  | `nil`
`fluentd.metrics.serviceMonitor.interval`         | Scrape interval. If not set, the Prometheus default scrape interval is used           | `nil`
`fluentd.metrics.serviceMonitor.scrapeTimeout`    | Scrape timeout. If not set, the Prometheus default scrape timeout is used             | `nil`

 
#### [ElasticSearch](https://github.com/elastic/helm-charts/tree/master/elasticsearch)

| Parameter                     | Description                                                                                                                                                                                                                                                                                                                | Default                                                                                                                   |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| `elasticsearch.clusterName`                 | This will be used as the Elasticsearch [cluster.name](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.name.html) and should be unique per cluster in the namespace                                                                                                                                 | `elasticsearch`                                                                                                           |
| `elasticsearch.nodeGroup`                   | This is the name that will be used for each group of nodes in the cluster. The name will be `clusterName-nodeGroup-X`                                                                                                                                                                                                      | `master`                                                                                                                  |
| `elasticsearch.masterService`               | Optional. The service name used to connect to the masters. You only need to set this if your master `nodeGroup` is set to something other than `master`. See [Clustering and Node Discovery](#clustering-and-node-discovery) for more information.                                                                         | ``                                                                                                                        |
| `elasticsearch.roles`                       | A hash map with the [specific roles](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html) for the node group                                                                                                                                                                                 | `master: true`<br>`data: true`<br>`ingest: true`                                                                          |
| `elasticsearch.replicas`                    | Kubernetes replica count for the statefulset (i.e. how many pods)                                                                                                                                                                                                                                                          | `2`                                                                                                                       |
| `elasticsearch.minimumMasterNodes`          | The value for [discovery.zen.minimum_master_nodes](https://www.elastic.co/guide/en/elasticsearch/reference/6.7/discovery-settings.html#minimum_master_nodes). Should be set to `(master_eligible_nodes / 2) + 1`. Ignored in Elasticsearch versions >= 7.                                                                  | `2`                                                                                                                       |
| `elasticsearch.esMajorVersion`              | Used to set major version specific configuration. If you are using a custom image and not running the default Elasticsearch version you will need to set this to the version you are running (e.g. `esMajorVersion: 6`)                                                                                                    | `""`                                                                                                                      |
| `elasticsearch.esConfig`                    | Allows you to add any config files in `/usr/share/elasticsearch/config/` such as `elasticsearch.yml` and `log4j2.properties`. See [values.yaml](./values.yaml) for an example of the formatting.                                                                                                                           | `{}`                                                                                                                      |
| `elasticsearch.extraEnvs`                   | Extra [environment variables](https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/#using-environment-variables-inside-of-your-config) which will be appended to the `env:` definition for the container                                                                         | `[]`                                                                                                                      |
| `elasticsearch.extraVolumes`                | Templatable string of additional volumes to be passed to the `tpl` function                                                                                                                                                                                                                                                | `""`                                                                                                                      |
| `elasticsearch.extraVolumeMounts`           | Templatable string of additional volumeMounts to be passed to the `tpl` function                                                                                                                                                                                                                                           | `""`                                                                                                                      |
| `elasticsearch.extraInitContainers`         | Templatable string of additional init containers to be passed to the `tpl` function                                                                                                                                                                                                                                        | `""`                                                                                                                      |
| `elasticsearch.secretMounts`                | Allows you easily mount a secret as a file inside the statefulset. Useful for mounting certificates and other secrets. See [values.yaml](./values.yaml) for an example                                                                                                                                                     | `[]`                                                                                                                      |
| `elasticsearch.image`                       | The Elasticsearch docker image                                                                                                                                                                                                                                                                                             | `docker.elastic.co/elasticsearch/elasticsearch`                                                                           |
| `elasticsearch.imageTag`                    | The Elasticsearch docker image tag                                                                                                                                                                                                                                                                                         | `7.5.0`                                                                                                                   |
| `elasticsearch.imagePullPolicy`             | The Kubernetes [imagePullPolicy](https://kubernetes.io/docs/concepts/containers/images/#updating-images) value                                                                                                                                                                                                             | `IfNotPresent`                                                                                                            |
| `elasticsearch.podAnnotations`              | Configurable [annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/) applied to all Elasticsearch pods                                                                                                                                                                               | `{}`                                                                                                                      |
| `elasticsearch.labels`                      | Configurable [label](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/) applied to all Elasticsearch pods                                                                                                                                                                                          | `{}`                                                                                                                      |
| `elasticsearch.esJavaOpts`                  | [Java options](https://www.elastic.co/guide/en/elasticsearch/reference/current/jvm-options.html) for Elasticsearch. This is where you should configure the [jvm heap size](https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html)                                                                 | `-Xmx1g -Xms1g`                                                                                                           |
| `elasticsearch.resources`                   | Allows you to set the [resources](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) for the statefulset                                                                                                                                                                               | `requests.cpu: 100m`<br>`requests.memory: 2Gi`<br>`limits.cpu: 1000m`<br>`limits.memory: 2Gi`                             |
| `elasticsearch.initResources`               | Allows you to set the [resources](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) for the initContainer in the statefulset                                                                                                                                                          | {}                                                                                                                        |
| `elasticsearch.sidecarResources`            | Allows you to set the [resources](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) for the sidecar containers in the statefulset                                                                                                                                                     | {}                                                                                                                        |
| `elasticsearch.networkHost`                 | Value for the [network.host Elasticsearch setting](https://www.elastic.co/guide/en/elasticsearch/reference/current/network.host.html)                                                                                                                                                                                      | `0.0.0.0`                                                                                                                 |
| `elasticsearch.volumeClaimTemplate`         | Configuration for the [volumeClaimTemplate for statefulsets](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#stable-storage). You will want to adjust the storage (default `30Gi`) and the `storageClassName` if you are using a different storage class                                            | `accessModes: [ "ReadWriteOnce" ]`<br>`resources.requests.storage: 30Gi`                                                  |
| `elasticsearch.persistence.annotations`     | Additional persistence annotations for the `volumeClaimTemplate`                                                                                                                                                                                                                                                           | `{}`                                                                                                                      |
| `elasticsearch.persistence.enabled`         | Enables a persistent volume for Elasticsearch data. Can be disabled for nodes that only have [roles](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html) which don't require persistent data.                                                                                               | `true`                                                                                                                    |
| `elasticsearch.priorityClassName`           | The [name of the PriorityClass](https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass). No default is supplied as the PriorityClass must be created first.                                                                                                                              | `""`                                                                                                                      |
| `elasticsearch.antiAffinityTopologyKey`     | The [anti-affinity topology key](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity). By default this will prevent multiple Elasticsearch nodes from running on the same Kubernetes node                                                                                        | `kubernetes.io/hostname`                                                                                                  |
| `elasticsearch.antiAffinity`                | Setting this to hard enforces the [anti-affinity rules](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity). If it is set to soft it will be done "best effort". Other values will be ignored.                                                                                  | `hard`                                                                                                                    |
| `elasticsearch.nodeAffinity`                | Value for the [node affinity settings](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity-beta-feature)                                                                                                                                                                                      | `{}`                                                                                                                      |
| `elasticsearch.podManagementPolicy`         | By default Kubernetes [deploys statefulsets serially](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies). This deploys them in parallel so that they can discover eachother                                                                                                   | `Parallel`                                                                                                                |
| `elasticsearch.protocol`                    | The protocol that will be used for the readinessProbe. Change this to `https` if you have `xpack.security.http.ssl.enabled` set                                                                                                                                                                                            | `http`                                                                                                                    |
| `elasticsearch.httpPort`                    | The http port that Kubernetes will use for the healthchecks and the service. If you change this you will also need to set [http.port](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-http.html#_settings) in `extraEnvs`                                                                          | `9200`                                                                                                                    |
| `elasticsearch.transportPort`               | The transport port that Kubernetes will use for the service. If you change this you will also need to set [transport port configuration](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-transport.html#_transport_settings) in `extraEnvs`                                                        | `9300`                                                                                                                    |
| `elasticsearch.service.labels`              | Labels to be added to non-headless service                                                                                                                                                                                                                                                                                 | `{}`                                                                                                                      |
| `elasticsearch.service.labelsHeadless`      | Labels to be added to headless service                                                                                                                                                                                                                                                                                     | `{}`                                                                                                                      |
| `elasticsearch.service.type`                | Type of elasticsearch service. [Service Types](https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types)                                                                                                                                                                         | `ClusterIP`                                                                                                               |
| `elasticsearch.service.nodePort`            | Custom [nodePort](https://kubernetes.io/docs/concepts/services-networking/service/#nodeport) port that can be set if you are using `service.type: nodePort`.                                                                                                                                                               | ``                                                                                                                        |
| `elasticsearch.service.annotations`         | Annotations that Kubernetes will use for the service. This will configure load balancer if `service.type` is `LoadBalancer` [Annotations](https://kubernetes.io/docs/concepts/services-networking/service/#ssl-support-on-aws)                                                                                             | `{}`                                                                                                                      |
| `elasticsearch.service.httpPortName`        | The name of the http port within the service                                                                                                                                                                                                                                                                               | `http`                                                                                                                    |
| `elasticsearch.service.transportPortName`   | The name of the transport port within the service                                                                                                                                                                                                                                                                          | `transport`                                                                                                               |
| `elasticsearch.updateStrategy`              | The [updateStrategy](https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#updating-statefulsets) for the statefulset. By default Kubernetes will wait for the cluster to be green after upgrading each pod. Setting this to `OnDelete` will allow you to manually delete each pod during upgrades | `RollingUpdate`                                                                                                           |
| `elasticsearch.maxUnavailable`              | The [maxUnavailable](https://kubernetes.io/docs/tasks/run-application/configure-pdb/#specifying-a-poddisruptionbudget) value for the pod disruption budget. By default this will prevent Kubernetes from having more than 1 unhealthy pod in the node group                                                                | `1`                                                                                                                       |
| `elasticsearch.fsGroup (DEPRECATED)`        | The Group ID (GID) for [securityContext.fsGroup](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/) so that the Elasticsearch user can read from the persistent volume                                                                                                                            | ``                                                                                                                        |
| `elasticsearch.podSecurityContext`          | Allows you to set the [securityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod) for the pod                                                                                                                                                         | `fsGroup: 1000`<br>`runAsUser: 1000`                                                                                      |
| `elasticsearch.securityContext`             | Allows you to set the [securityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container) for the container                                                                                                                                             | `capabilities.drop:[ALL]`<br>`runAsNonRoot: true`<br>`runAsUser: 1000`                                                    |
| `elasticsearch.terminationGracePeriod`      | The [terminationGracePeriod](https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods) in seconds used when trying to stop the pod                                                                                                                                                                      | `120`                                                                                                                     |
| `elasticsearch.sysctlInitContainer.enabled` | Allows you to disable the sysctlInitContainer if you are setting vm.max_map_count with another method                                                                                                                                                                                                                      | `true`                                                                                                                    |
| `elasticsearch.sysctlVmMaxMapCount`         | Sets the [sysctl vm.max_map_count](https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html#vm-max-map-count) needed for Elasticsearch                                                                                                                                                        | `262144`                                                                                                                  |
| `elasticsearch.readinessProbe`              | Configuration fields for the [readinessProbe](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/)                                                                                                                                                                               | `failureThreshold: 3`<br>`initialDelaySeconds: 10`<br>`periodSeconds: 10`<br>`successThreshold: 3`<br>`timeoutSeconds: 5` |
| `elasticsearch.clusterHealthCheckParams`    | The [Elasticsearch cluster health status params](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-health.html#request-params) that will be used by readinessProbe command                                                                                                                           | `wait_for_status=green&timeout=1s`                                                                                        |
| `elasticsearch.imagePullSecrets`            | Configuration for [imagePullSecrets](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-pod-that-uses-your-secret) so that you can use a private registry for your image                                                                                                       | `[]`                                                                                                                      |
| `elasticsearch.nodeSelector`                | Configurable [nodeSelector](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector) so that you can target specific nodes for your Elasticsearch cluster                                                                                                                                          | `{}`                                                                                                                      |
| `elasticsearch.tolerations`                 | Configurable [tolerations](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/)                                                                                                                                                                                                                        | `[]`                                                                                                                      |
| `elasticsearch.ingress`                     | Configurable [ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) to expose the Elasticsearch service. See [`values.yaml`](./values.yaml) for an example                                                                                                                                            | `enabled: false`                                                                                                          |
| `elasticsearch.schedulerName`               | Name of the [alternate scheduler](https://kubernetes.io/docs/tasks/administer-cluster/configure-multiple-schedulers/#specify-schedulers-for-pods)                                                                                                                                                                          | `nil`                                                                                                                     |
| `elasticsearch.masterTerminationFix`        | A workaround needed for Elasticsearch < 7.2 to prevent master status being lost during restarts [#63](https://github.com/elastic/helm-charts/issues/63)                                                                                                                                                                    | `false`                                                                                                                   |
| `elasticsearch.lifecycle`                   | Allows you to add lifecycle configuration. See [values.yaml](./values.yaml) for an example of the formatting.                                                                                                                                                                                                              | `{}`                                                                                                                      |
| `elasticsearch.keystore`                    | Allows you map Kubernetes secrets into the keystore. See the [config example](/elasticsearch/examples/config/values.yaml) and [how to use the keystore](#how-to-use-the-keystore)                                                                                                                                          | `[]`                                                                                                                      |
| `elasticsearch.rbac`                    | Configuration for creating a role, role binding and service account as part of this helm chart with `create: true`. Also can be used to reference an external service account with `serviceAccountName: "externalServiceAccountName"`.                                                                                             | `create: false`<br>`serviceAccountName: ""`                       |
| `elasticsearch.podSecurityPolicy`       | Configuration for create a pod security policy with minimal permissions to run this Helm chart with `create: true`. Also can be used to reference an external pod security policy with `name: "externalPodSecurityPolicy"`                                                                                                         | `create: false`<br>`name: ""`                                     |


#### [Kibana](https://github.com/elastic/helm-charts/tree/master/kibana)

| Parameter                 | Description                                                                                                                                                                                                                                                                                                                                                    | Default                                                                                                                   |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| `kibana.elasticsearchHosts`      | The URLs used to connect to Elasticsearch.                                                                                                                                                                                                                                                                                                                     | `http://elasticsearch-master:9200`                                                                                        |
| `kibana.elasticsearchURL`        | The URL used to connect to Elasticsearch. Deprecated, needs to be used for Kibana versions < 6.6                                                                                                                                                                                                                                                               |                                                                                                                           |
| `kibana.replicas`                | Kubernetes replica count for the deployment (i.e. how many pods)                                                                                                                                                                                                                                                                                               | `1`                                                                                                                       |
| `kibana.extraEnvs`               | Extra [environment variables](https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/#using-environment-variables-inside-of-your-config) which will be appended to the `env:` definition for the container                                                                                                             | `[]`                                                                                                                      |
| `kibana.secretMounts`            | Allows you easily mount a secret as a file inside the deployment. Useful for mounting certificates and other secrets. See [values.yaml](./values.yaml) for an example                                                                                                                                                                                          | `[]`                                                                                                                      |
| `kibana.image`                   | The Kibana docker image                                                                                                                                                                                                                                                                                                                                        | `docker.elastic.co/kibana/kibana`                                                                                         |
| `kibana.imageTag`                | The Kibana docker image tag                                                                                                                                                                                                                                                                                                                                    | `7.5.0`                                                                                                                   |
| `kibana.imagePullPolicy`         | The Kubernetes [imagePullPolicy](https://kubernetes.io/docs/concepts/containers/images/#updating-images) value                                                                                                                                                                                                                                                 | `IfNotPresent`                                                                                                            |
| `kibana.podAnnotations`          | Configurable [annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/) applied to all Kibana pods                                                                                                                                                                                                                          | `{}`                                                                                                                      |
| `kibana.resources`               | Allows you to set the [resources](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) for the statefulset                                                                                                                                                                                                                   | `requests.cpu: 100m`<br>`requests.memory: 500Mi`<br>`limits.cpu: 1000m`<br>`limits.memory: 2Gi`                             |
| `kibana.protocol`                | The protocol that will be used for the readinessProbe. Change this to `https` if you have `server.ssl.enabled: true` set                                                                                                                                                                                                                                       | `http`                                                                                                                    |
| `kibana.serverHost`              | The [`server.host`](https://www.elastic.co/guide/en/kibana/current/settings.html) Kibana setting. This is set explicitly so that the default always matches what comes with the docker image.                                                                                                                                                                  | `0.0.0.0`                                                                                                                 |
| `kibana.healthCheckPath`         | The path used for the readinessProbe to check that Kibana is ready. If you are setting `server.basePath` you will also need to update this to `/${basePath}/app/kibana`                                                                                                                                                                                        | `/app/kibana`                                                                                                             |
| `kibana.kibanaConfig`            | Allows you to add any config files in `/usr/share/kibana/config/` such as `kibana.yml`. See [values.yaml](./values.yaml) for an example of the formatting.                                                                                                                                                                                                     | `{}`                                                                                                                      |
| `kibana.podSecurityContext`      | Allows you to set the [securityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod) for the pod                                                                                                                                                                                             | `fsGroup: 1000`                                                                                                           |
| `kibana.securityContext`         | Allows you to set the [securityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container) for the container                                                                                                                                                                                 | `capabilities.drop:[ALL]`<br>`runAsNonRoot: true`<br>`runAsUser: 1000`                                                    |
| `kibana.serviceAccount`          | Allows you to overwrite the "default" [serviceAccount](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) for the pod                                                                                                                                                                                                        | `[]`                                                                                                                      |
| `kibana.priorityClassName`       | The [name of the PriorityClass](https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass). No default is supplied as the PriorityClass must be created first.                                                                                                                                                                  | `""`                                                                                                                      |
| `kibana.httpPort`                | The http port that Kubernetes will use for the healthchecks and the service.                                                                                                                                                                                                                                                                                   | `5601`                                                                                                                    |
| `kibana.maxUnavailable`          | The [maxUnavailable](https://kubernetes.io/docs/tasks/run-application/configure-pdb/#specifying-a-poddisruptionbudget) value for the pod disruption budget. By default this will prevent Kubernetes from having more than 1 unhealthy pod                                                                                                                      | `1`                                                                                                                       |
| `kibana.updateStrategy`          | Allows you to change the default update [strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment) for the deployment. A [standard upgrade](https://www.elastic.co/guide/en/kibana/current/upgrade-standard.html) of Kibana requires a full stop and start which is why the default strategy is set to `Recreate` | `Recreate`                                                                                                                |
| `kibana.readinessProbe`          | Configuration for the [readinessProbe](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/)                                                                                                                                                                                                                          | `failureThreshold: 3`<br>`initialDelaySeconds: 10`<br>`periodSeconds: 10`<br>`successThreshold: 3`<br>`timeoutSeconds: 5` |
| `kibana.imagePullSecrets`        | Configuration for [imagePullSecrets](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-pod-that-uses-your-secret) so that you can use a private registry for your image                                                                                                                                           | `[]`                                                                                                                      |
| `kibana.nodeSelector`            | Configurable [nodeSelector](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector) so that you can target specific nodes for your Kibana instances                                                                                                                                                                                   | `{}`                                                                                                                      |
| `kibana.tolerations`             | Configurable [tolerations](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/)                                                                                                                                                                                                                                                            | `[]`                                                                                                                      |
| `kibana.ingress`                 | Configurable [ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) to expose the Kibana service. See [`values.yaml`](./values.yaml) for an example                                                                                                                                                                                       | `enabled: false`                                                                                                          |
| `kibana.service`                 | Configurable [service](https://kubernetes.io/docs/concepts/services-networking/service/) to expose the Kibana service. See [`values.yaml`](./values.yaml) for an example                                                                                                                                                                                       | `type: ClusterIP`<br>`port: 5601`<br>`nodePort:`<br>`annotations: {}`                                                     |
| `kibana.labels`                  | Configurable [label](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/) applied to all Kibana pods                                                                                                                                                                                                                                     | `{}`                                                                                                                      |
| `kibana.lifecycle`               | Allows you to add lifecycle configuration. See [values.yaml](./values.yaml) for an example of the formatting.                                                                                                                                                                                                                                                  | `{}`                                                                                                                      |
| `kibana.fullnameOverride`       | Overrides the full name of the resources. If not set the name will default to "`.Release.Name`-`.Values.nameOverride or .Chart.Name`"                                                                                                                                       | `""`                                                                                                                      |


Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example,

```bash
$ helm install qubole/logging --name efk \
    --set kibana.httpPorts=8080
```

